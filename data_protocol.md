# 学ロボ2024 CAN/Serialプロトコル  

### CANの場合  

| bit | 名称 | 概要 |
|:--:|:--:|:--:|
|28:26|Priority level|優先度|
|25:22|Board type|基板の種類|
|21:18|Board ID|基板の固有ID|
|17:12|予約済み|0埋め推奨|
|11:8|Device ID|基板につながるデバイスを指定|
|7:0|Register ID||

なお、Board typeは次の様
| 名称 | ID |
|:--:|:--:|
| 電源基板 | 0x1 |
| ロボマス制御 | 0x2 |
| 汎用GPIO | 0x3 |
| コール用予約済み | 0x0 |

Board IDはロータリーDIPなどで指定される値。  

Device IDは基板に接続されているデバイスの番号（ロボマス制御基板につながるID3のロボマスモタドラに関して触りたいなら0x3にする、的な）。  
あとDevice ID=0は基板自体に関してｳﾝﾀﾗｶﾝﾀﾗしたいとき用。  

なお、標準ID0x0を接続デバイス確認用に使用する。  
これを受信したデバイスは利用可能なIDを返答。  
つまりID1とID3のロボマスモタドラが接続されているBoard ID=3のロボマスモタドラ制御基板が0xP00を受信したら(0xP23 <<18)|(0x100) と(0xP23 <<18)|(0x300) を返答する。  

### Serialの場合  

|byte| bit | 名称 | 概要 |
|:--:|:--:|:--:|:--:|
|0|7|W/R|リモートフレーム枠|
|0|6:4|priority level||
|0|3:0|Board type|基板の種類|
|1|7:4|Board ID|基板の固有ID|
|1|3:0|Device ID||
|2|7:0|Register ID||

0x000000をデバイス確認用に使用。  
動きはCANとおなじ。  

とまあこんな感じで生成されるデータをやりとりするが、COBS形式にエンコードしてもいいかもしれないし、そもそもバイナリじゃなくて文字データの方が便利そう感はある。  